
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Practical backend engineering notes">
      
      
        <meta name="author" content="labeeb">
      
      
      
        <link rel="prev" href="../microservices/">
      
      
        <link rel="next" href="../domain-exceptions-in-ts/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Layered Architecture & Exception Handling Guide - Backend Engineering Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#layered-architecture-exception-handling-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Backend Engineering Notes" class="md-header__button md-logo" aria-label="Backend Engineering Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Backend Engineering Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Layered Architecture & Exception Handling Guide
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Backend Engineering Notes" class="md-nav__button md-logo" aria-label="Backend Engineering Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Backend Engineering Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Main
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Networking
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/osi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OSI Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/osi-unit-of-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OSI Layer's Unit of Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Databases
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Databases
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/Database-Optimization-From-Indexes-to-Partitioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Optimization From Indexes to Partitioning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/optimistic-vs-pessimistic-locking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Optimistic vs Pessimistic Locking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" checked>
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../layered.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Layered
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../microservices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microservices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Layered Architecture & Exception Handling Guide
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Layered Architecture & Exception Handling Guide
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Principles
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-layers-depend-on-the-layer-below" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Layers Depend on the Layer Below
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-domain-must-be-transport-agnostic" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Domain Must Be Transport-Agnostic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-fail-fast" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Fail Fast
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-let-exceptions-bubble" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Let Exceptions Bubble
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-golden-rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Golden Rule
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Golden Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer Responsibilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer Responsibilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repository-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#servicedomain-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service/Domain Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controlleradapter-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Controller/Adapter Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-exception-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global Exception Handler
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exception-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exception Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exception Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visual-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#who-handles-what" class="md-nav__link">
    <span class="md-ellipsis">
      
        Who Handles What?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Design Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-1-let-exceptions-bubble-most-common" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Let Exceptions Bubble (Most Common)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-2-translate-at-domain-boundary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: Translate at Domain Boundary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-3-exception-mapper-helper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Exception Mapper Helper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-4-global-exception-filter-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: Global Exception Filter (Recommended)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-5-result-type-functional-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Result Type (Functional Approach)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trade-offs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-core-trade-off" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Core Trade-off
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decision-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decision Matrix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choosing-based-on-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Choosing Based on Context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-World Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-e-commerce-order-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: E-commerce Order Creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-payment-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Payment Processing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-user-registration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: User Registration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anti-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anti-Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Anti-Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anti-pattern-1-swallowing-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 1: Swallowing Exceptions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-pattern-2-domain-knows-about-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 2: Domain Knows About HTTP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-pattern-3-generic-error-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 3: Generic Error Messages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-pattern-4-catching-without-re-throwing" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 4: Catching Without Re-throwing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-pattern-5-controller-contains-business-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 5: Controller Contains Business Logic
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-throw-vs-return-null" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Throw vs Return Null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exception-handling-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exception Handling Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-domain-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Domain Exceptions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further Reading
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Further Reading">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architectural-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architectural Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practical-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Practical Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framework-specific" class="md-nav__link">
    <span class="md-ellipsis">
      
        Framework-Specific
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    <span class="md-ellipsis">
      
        License
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contributing
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../domain-exceptions-in-ts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Domain Exceptions in Typescript
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../NestJS%20Service%20Layer%20Types%20-%20Best%20Practices/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NestJS Service Layer Types - Best Practices.md
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../redis-hset-and-hincrby/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Working with Redis Hashes- HSET and HINCRBY
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Principles
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-layers-depend-on-the-layer-below" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Layers Depend on the Layer Below
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-domain-must-be-transport-agnostic" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Domain Must Be Transport-Agnostic
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-fail-fast" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Fail Fast
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-let-exceptions-bubble" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Let Exceptions Bubble
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-golden-rule" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Golden Rule
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Golden Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Layer Responsibilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer Responsibilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repository-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Repository Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#servicedomain-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service/Domain Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controlleradapter-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Controller/Adapter Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-exception-handler" class="md-nav__link">
    <span class="md-ellipsis">
      
        Global Exception Handler
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exception-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exception Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exception Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visual-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#who-handles-what" class="md-nav__link">
    <span class="md-ellipsis">
      
        Who Handles What?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Design Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-1-let-exceptions-bubble-most-common" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 1: Let Exceptions Bubble (Most Common)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-2-translate-at-domain-boundary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 2: Translate at Domain Boundary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-3-exception-mapper-helper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 3: Exception Mapper Helper
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-4-global-exception-filter-recommended" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 4: Global Exception Filter (Recommended)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-5-result-type-functional-approach" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern 5: Result Type (Functional Approach)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trade-offs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trade-offs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-core-trade-off" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Core Trade-off
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decision-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decision Matrix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choosing-based-on-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Choosing Based on Context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-World Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-e-commerce-order-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: E-commerce Order Creation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-payment-processing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Payment Processing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-user-registration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: User Registration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anti-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anti-Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Anti-Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anti-pattern-1-swallowing-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 1: Swallowing Exceptions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-pattern-2-domain-knows-about-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 2: Domain Knows About HTTP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-pattern-3-generic-error-messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 3: Generic Error Messages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-pattern-4-catching-without-re-throwing" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 4: Catching Without Re-throwing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-pattern-5-controller-contains-business-logic" class="md-nav__link">
    <span class="md-ellipsis">
      
        ❌ Anti-Pattern 5: Controller Contains Business Logic
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Reference
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-throw-vs-return-null" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Throw vs Return Null
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exception-handling-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exception Handling Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-domain-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common Domain Exceptions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-reading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Further Reading
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Further Reading">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architectural-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architectural Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#practical-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Practical Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#framework-specific" class="md-nav__link">
    <span class="md-ellipsis">
      
        Framework-Specific
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    <span class="md-ellipsis">
      
        License
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contributing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contributing
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="layered-architecture-exception-handling-guide">Layered Architecture &amp; Exception Handling Guide</h1>
<p>A comprehensive guide to exception handling patterns in layered architecture for building maintainable, reusable systems.</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#core-principles">Core Principles</a></li>
<li><a href="#the-golden-rule">The Golden Rule</a></li>
<li><a href="#layer-responsibilities">Layer Responsibilities</a></li>
<li><a href="#exception-flow">Exception Flow</a></li>
<li><a href="#design-patterns">Design Patterns</a></li>
<li><a href="#trade-offs">Trade-offs</a></li>
<li><a href="#real-world-examples">Real-World Examples</a></li>
<li><a href="#anti-patterns">Anti-Patterns</a></li>
<li><a href="#quick-reference">Quick Reference</a></li>
</ul>
<hr />
<h2 id="core-principles">Core Principles</h2>
<h3 id="1-layers-depend-on-the-layer-below">1. Layers Depend on the Layer Below</h3>
<pre><code>Controller/Adapter
    ↓ depends on
Service/Domain
    ↓ depends on
Repository/Infrastructure
</code></pre>
<p><strong>Never reverse:</strong> Domain should never import from Controller.</p>
<h3 id="2-domain-must-be-transport-agnostic">2. Domain Must Be Transport-Agnostic</h3>
<p>The domain layer should not know about HTTP, CLI, queues, or any delivery mechanism.</p>
<pre><code class="language-typescript">// ❌ Bad - domain knows about HTTP
throw new NotFoundException() // HTTP-specific

// ✅ Good - domain exception
throw new UserNotFound() // Pure domain
</code></pre>
<h3 id="3-fail-fast">3. Fail Fast</h3>
<p>Throw immediately when something is wrong. Don't continue execution in an invalid state.</p>
<pre><code class="language-typescript">async createOrder(userId: string, productId: string) {
  const user = await this.getUser(userId)
  if (!user) throw new UserNotFound() // Stop immediately

  const product = await this.getProduct(productId)
  if (!product) throw new ProductNotFound() // Stop immediately

  // Happy path continues
  return this.orderRepo.create({ user, product })
}
</code></pre>
<h3 id="4-let-exceptions-bubble">4. Let Exceptions Bubble</h3>
<p>Don't catch exceptions unless you're actually handling them. Let them propagate to the appropriate layer.</p>
<pre><code class="language-typescript">// ❌ Bad - exception buried
try {
  await service.createOrder(data)
} catch (e) {
  console.log('Error:', e)
  // Exception dies here!
}

// ✅ Good - let it bubble
await service.createOrder(data)
</code></pre>
<hr />
<h2 id="the-golden-rule">The Golden Rule</h2>
<p>When to throw vs. return optional values:</p>
<blockquote>
<p><strong>If the caller could reasonably branch on the result</strong> → return <code>null</code> / <code>Result</code></p>
<p><strong>If continuing execution would be incorrect</strong> → throw</p>
</blockquote>
<h3 id="examples">Examples</h3>
<p><strong>Return null for queries:</strong></p>
<pre><code class="language-typescript">async findProduct(sku: string): Promise&lt;Product | null&gt; {
  return this.prisma.product.findUnique({ where: { sku } })
}
</code></pre>
<p><strong>Throw for commands:</strong></p>
<pre><code class="language-typescript">async getProductOrThrow(sku: string): Promise&lt;Product&gt; {
  const product = await this.prisma.product.findUnique({ where: { sku } })
  if (!product) throw new ProductNotFound()
  return product
}
</code></pre>
<hr />
<h2 id="layer-responsibilities">Layer Responsibilities</h2>
<h3 id="repository-layer">Repository Layer</h3>
<p><strong>Responsibility:</strong> Answer data questions</p>
<pre><code class="language-typescript">class ProductRepository {
  async findById(id: string): Promise&lt;Product | null&gt; {
    return this.prisma.product.findUnique({ where: { id } })
  }
}
</code></pre>
<ul>
<li>Returns <code>null</code> for "not found"</li>
<li>Throws infrastructure exceptions (DB errors, network timeouts)</li>
<li>No business logic</li>
</ul>
<h3 id="servicedomain-layer">Service/Domain Layer</h3>
<p><strong>Responsibility:</strong> Enforce business rules and invariants</p>
<pre><code class="language-typescript">class OrderService {
  async createOrder(userId: string, sku: string) {
    // Enforce invariants - throw if violated
    const user = await this.userService.getOrThrow(userId)
    const product = await this.productService.getOrThrow(sku)

    if (product.stock &lt; 1) {
      throw new OutOfStock(sku)
    }

    return this.orderRepo.create({ user, product })
  }
}
</code></pre>
<ul>
<li>Throws domain exceptions when invariants are violated</li>
<li>Does NOT catch its own exceptions (usually)</li>
<li>May translate infrastructure exceptions to domain exceptions</li>
<li>Transport-agnostic (doesn't know about HTTP/CLI)</li>
</ul>
<h3 id="controlleradapter-layer">Controller/Adapter Layer</h3>
<p><strong>Responsibility:</strong> Translate between domain and external world</p>
<pre><code class="language-typescript">@Post('/orders')
async createOrder(@Body() dto: CreateOrderDto) {
  try {
    const order = await this.orderService.createOrder(dto.userId, dto.sku)
    return { status: 201, data: order }
  } catch (e) {
    if (e instanceof UserNotFound) 
      throw new NotFoundException('User not found')
    if (e instanceof ProductNotFound) 
      throw new NotFoundException('Product not found')
    if (e instanceof OutOfStock) 
      throw new BadRequestException('Product out of stock')
    throw e
  }
}
</code></pre>
<ul>
<li>Catches domain exceptions</li>
<li>Translates to transport responses (HTTP status codes, CLI exit codes, etc.)</li>
<li>Validates input shape (not business rules)</li>
</ul>
<h3 id="global-exception-handler">Global Exception Handler</h3>
<p><strong>Responsibility:</strong> Safety net for unhandled exceptions</p>
<pre><code class="language-typescript">@Catch()
export class GlobalExceptionFilter {
  catch(exception: unknown, host: ArgumentsHost) {
    const ctx = host.switchToHttp()
    const response = ctx.getResponse()

    this.logger.error('Unhandled exception', exception)

    if (exception instanceof UserNotFound) {
      return response.status(404).json({ message: 'User not found' })
    }

    if (exception instanceof DatabaseError) {
      this.alerting.criticalError(exception)
    }

    return response.status(500).json({ message: 'Internal server error' })
  }
}
</code></pre>
<ul>
<li>Catches all unhandled exceptions</li>
<li>Centralizes exception-to-HTTP mapping</li>
<li>Logs and monitors</li>
<li>Returns appropriate error responses</li>
</ul>
<hr />
<h2 id="exception-flow">Exception Flow</h2>
<h3 id="visual-flow">Visual Flow</h3>
<pre><code>┌─────────────────────────────────────────────────┐
│ Client Request                                   │
└──────────────┬──────────────────────────────────┘
               │
               ↓
┌──────────────────────────────────────────────────┐
│ Controller/Adapter                               │
│ try {                                            │
│   service.createOrder()                          │ ← Catches &amp; translates
│ } catch (DomainException) {                      │
│   → 404, 400, 409, etc.                         │
│ }                                                │
└──────────────┬───────────────────────────────────┘
               │
               ↓
┌──────────────────────────────────────────────────┐
│ Service/Domain                                   │
│ - Enforces invariants                            │
│ - Throws domain exceptions                       │ ← Throws, doesn't catch
│ - NO try-catch (unless translating)              │
└──────────────┬───────────────────────────────────┘
               │
               ↓
┌──────────────────────────────────────────────────┐
│ Repository/Infrastructure                        │
│ - DB errors, network errors                      │
│ - Throws infrastructure exceptions               │
└──────────────┬───────────────────────────────────┘
               │
               ↓ (if not caught in controller)
┌──────────────────────────────────────────────────┐
│ Global Exception Handler                         │
│ - Logs unexpected errors                         │ ← Safety net
│ - Returns 500                                    │
│ - Alerts monitoring                              │
└──────────────────────────────────────────────────┘
</code></pre>
<h3 id="who-handles-what">Who Handles What?</h3>
<table>
<thead>
<tr>
<th>Exception Type</th>
<th>Usually Handled By</th>
<th>Alternative</th>
</tr>
</thead>
<tbody>
<tr>
<td>Domain exceptions</td>
<td>Controller or Global Handler</td>
<td>-</td>
</tr>
<tr>
<td>Database errors</td>
<td>Controller or Global Handler</td>
<td>Domain (if translating)</td>
</tr>
<tr>
<td>Network timeouts</td>
<td>Global Handler</td>
<td>Controller (if specific handling)</td>
</tr>
<tr>
<td>Validation errors</td>
<td>Domain (throws immediately)</td>
<td>-</td>
</tr>
<tr>
<td>Business rule violations</td>
<td>Domain (throws)</td>
<td>-</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="design-patterns">Design Patterns</h2>
<h3 id="pattern-1-let-exceptions-bubble-most-common">Pattern 1: Let Exceptions Bubble (Most Common)</h3>
<pre><code class="language-typescript">// Repository
class ProductRepository {
  async findById(id: string) {
    return this.prisma.product.findUnique({ where: { id } })
    // Can throw: PrismaClientKnownRequestError, NetworkError, etc.
  }
}

// Service - does NOT catch
class OrderService {
  async createOrder(productId: string) {
    const product = await this.productRepo.findById(productId)
    // If DB error happens, it just bubbles up
  }
}

// Controller - catches everything
try {
  await orderService.createOrder(productId)
} catch (e) {
  if (e instanceof ProductNotFound) throw new NotFoundException()
  if (e instanceof PrismaClientKnownRequestError) {
    throw new ServiceUnavailableException('Database error')
  }
  throw e
}
</code></pre>
<p><strong>When to use:</strong> Most of the time. Simple, predictable, works well.</p>
<h3 id="pattern-2-translate-at-domain-boundary">Pattern 2: Translate at Domain Boundary</h3>
<pre><code class="language-typescript">// Service - translates infrastructure → domain
class OrderService {
  async createOrder(productId: string) {
    try {
      const product = await this.productRepo.findById(productId)
    } catch (e) {
      if (e instanceof PrismaClientKnownRequestError) {
        throw new ProductRepositoryError('Failed to fetch product')
      }
      throw e
    }
  }
}

// Controller - only handles domain errors
try {
  await orderService.createOrder(productId)
} catch (e) {
  if (e instanceof ProductRepositoryError) {
    throw new ServiceUnavailableException()
  }
  throw e
}
</code></pre>
<p><strong>When to use:</strong> When you want to hide infrastructure details, or might swap implementations later.</p>
<h3 id="pattern-3-exception-mapper-helper">Pattern 3: Exception Mapper Helper</h3>
<pre><code class="language-typescript">// exception-mapper.ts
export class ExceptionMapper {
  static toHttp(error: Error): HttpException {
    if (error instanceof UserNotFound) 
      return new NotFoundException('User not found')
    if (error instanceof ProductNotFound) 
      return new NotFoundException('Product not found')
    if (error instanceof InsufficientStock) 
      return new BadRequestException('Out of stock')
    if (error instanceof DuplicateOrder) 
      return new ConflictException('Order exists')

    return new InternalServerErrorException()
  }
}

// Controller - clean
try {
  return await service.createOrder(data)
} catch (e) {
  throw ExceptionMapper.toHttp(e)
}
</code></pre>
<p><strong>When to use:</strong> When you have many exception types and want centralized mapping.</p>
<h3 id="pattern-4-global-exception-filter-recommended">Pattern 4: Global Exception Filter (Recommended)</h3>
<pre><code class="language-typescript">// Service - just throws domain exceptions
class OrderService {
  async createOrder(data) {
    if (!user) throw new UserNotFound()
    if (!product) throw new ProductNotFound()
  }
}

// Controller - no try-catch at all!
@Post('/orders')
async createOrder(@Body() data: CreateOrderDto) {
  return await this.orderService.createOrder(data)
  // Let exceptions bubble to global filter
}

// Global filter - handles ALL exceptions
@Catch()
export class DomainExceptionFilter {
  catch(exception: unknown, host: ArgumentsHost) {
    const response = host.switchToHttp().getResponse()

    if (exception instanceof UserNotFound) {
      return response.status(404).json({ message: 'User not found' })
    }
    if (exception instanceof ProductNotFound) {
      return response.status(404).json({ message: 'Product not found' })
    }

    return response.status(500).json({ message: 'Internal error' })
  }
}
</code></pre>
<p><strong>When to use:</strong> Recommended for most applications. Keeps controllers clean, centralizes mapping.</p>
<h3 id="pattern-5-result-type-functional-approach">Pattern 5: Result Type (Functional Approach)</h3>
<pre><code class="language-typescript">type Result&lt;T, E&gt; = 
  | { ok: true; value: T } 
  | { ok: false; error: E }

// Service
async createOrder(userId: string): Promise&lt;Result&lt;Order, OrderError&gt;&gt; {
  const userResult = await this.userRepo.findById(userId)
  if (!userResult.ok) return { ok: false, error: 'UserNotFound' }

  return { ok: true, value: order }
}

// Controller
const result = await service.createOrder(userId)
if (!result.ok) {
  return this.handleError(result.error)
}
return result.value
</code></pre>
<p><strong>When to use:</strong> Functional programming style, when you want explicit error handling, inspired by Rust/Go.</p>
<hr />
<h2 id="trade-offs">Trade-offs</h2>
<h3 id="the-core-trade-off">The Core Trade-off</h3>
<pre><code>Option A: Domain throws generic/domain exceptions
  ✅ Domain is reusable across transports (HTTP, CLI, Queue)
  ❌ Controller must know all possible exceptions
  ❌ Controller does more work

Option B: Domain throws transport-specific exceptions
  ✅ Controller is simpler
  ❌ Domain is coupled to HTTP
  ❌ Can't reuse in non-HTTP contexts
</code></pre>
<h3 id="decision-matrix">Decision Matrix</h3>
<table>
<thead>
<tr>
<th>Approach</th>
<th>Domain Work</th>
<th>Controller Work</th>
<th>Reusability</th>
<th>When to Use</th>
</tr>
</thead>
<tbody>
<tr>
<td>Domain throws HTTP exceptions</td>
<td>Low</td>
<td>Low</td>
<td>❌ Low</td>
<td>Simple apps, single transport</td>
</tr>
<tr>
<td>Domain throws + Controller catches</td>
<td>Medium</td>
<td>High</td>
<td>✅ High</td>
<td>Multiple transports needed</td>
</tr>
<tr>
<td>Domain throws + Global filter</td>
<td>Medium</td>
<td>Low</td>
<td>✅ High</td>
<td><strong>Recommended for most</strong></td>
</tr>
<tr>
<td>Result types</td>
<td>High</td>
<td>Medium</td>
<td>✅ High</td>
<td>Functional style</td>
</tr>
</tbody>
</table>
<h3 id="choosing-based-on-context">Choosing Based on Context</h3>
<p><strong>Single HTTP API:</strong>
- Use global exception filter
- Trade-off: Worth it, clean controllers</p>
<p><strong>Multiple Transports (HTTP + CLI + Queue):</strong>
- Domain throws pure exceptions
- Each adapter translates
- Trade-off: Worth it, true reusability</p>
<p><strong>Simple CRUD App:</strong>
- Domain can throw HTTP exceptions directly
- Trade-off: Simplicity over "perfect" architecture</p>
<hr />
<h2 id="real-world-examples">Real-World Examples</h2>
<h3 id="example-1-e-commerce-order-creation">Example 1: E-commerce Order Creation</h3>
<pre><code class="language-typescript">// Domain exceptions
class UserNotFound extends Error {}
class ProductNotFound extends Error {}
class OutOfStock extends Error {}

// Repository
class ProductRepository {
  async findBySku(sku: string): Promise&lt;Product | null&gt; {
    return this.prisma.product.findUnique({ where: { sku } })
  }
}

// Service
class OrderService {
  async createOrder(userId: string, sku: string, quantity: number) {
    // Enforce invariants
    const user = await this.userRepo.findById(userId)
    if (!user) throw new UserNotFound(`User ${userId} not found`)

    const product = await this.productRepo.findBySku(sku)
    if (!product) throw new ProductNotFound(`Product ${sku} not found`)

    if (product.stock &lt; quantity) {
      throw new OutOfStock(`Only ${product.stock} units available`)
    }

    // Happy path
    await this.productRepo.decrementStock(sku, quantity)
    return this.orderRepo.create({ userId, sku, quantity })
  }
}

// Controller
@Post('/orders')
async createOrder(@Body() dto: CreateOrderDto) {
  // Option 1: Handle in controller
  try {
    const order = await this.orderService.createOrder(
      dto.userId, 
      dto.sku, 
      dto.quantity
    )
    return { status: 201, data: order }
  } catch (e) {
    if (e instanceof UserNotFound) 
      throw new NotFoundException(e.message)
    if (e instanceof ProductNotFound) 
      throw new NotFoundException(e.message)
    if (e instanceof OutOfStock) 
      throw new BadRequestException(e.message)
    throw e
  }

  // Option 2: Let global filter handle it
  return await this.orderService.createOrder(
    dto.userId, 
    dto.sku, 
    dto.quantity
  )
}
</code></pre>
<h3 id="example-2-payment-processing">Example 2: Payment Processing</h3>
<pre><code class="language-typescript">// Domain
class PaymentService {
  async processPayment(orderId: string, amount: number) {
    const order = await this.orderRepo.findById(orderId)
    if (!order) throw new OrderNotFound()

    if (order.status === 'paid') {
      throw new OrderAlreadyPaid()
    }

    // Call external payment gateway
    try {
      const result = await this.paymentGateway.charge(amount)
      await this.orderRepo.markAsPaid(orderId, result.transactionId)
      return result
    } catch (e) {
      // Translate infrastructure error to domain error
      if (e instanceof GatewayTimeout) {
        throw new PaymentGatewayUnavailable()
      }
      if (e instanceof InsufficientFunds) {
        throw new PaymentDeclined('Insufficient funds')
      }
      throw new PaymentFailed('Payment processing failed')
    }
  }
}

// Controller
@Post('/payments')
async processPayment(@Body() dto: ProcessPaymentDto) {
  try {
    const result = await this.paymentService.processPayment(
      dto.orderId, 
      dto.amount
    )
    return { status: 200, data: result }
  } catch (e) {
    if (e instanceof OrderNotFound) 
      throw new NotFoundException('Order not found')
    if (e instanceof OrderAlreadyPaid) 
      throw new ConflictException('Order already paid')
    if (e instanceof PaymentDeclined) 
      throw new BadRequestException(e.message)
    if (e instanceof PaymentGatewayUnavailable) 
      throw new ServiceUnavailableException('Payment gateway unavailable')
    throw e
  }
}
</code></pre>
<h3 id="example-3-user-registration">Example 3: User Registration</h3>
<pre><code class="language-typescript">// Domain
class UserService {
  async registerUser(email: string, password: string) {
    // Validate business rules
    if (!this.isValidEmail(email)) {
      throw new InvalidEmail('Email format is invalid')
    }

    if (password.length &lt; 8) {
      throw new WeakPassword('Password must be at least 8 characters')
    }

    // Check uniqueness
    const existing = await this.userRepo.findByEmail(email)
    if (existing) {
      throw new UserAlreadyExists('Email already registered')
    }

    // Hash password and create user
    const hashedPassword = await this.hashPassword(password)
    return this.userRepo.create({ email, password: hashedPassword })
  }

  private isValidEmail(email: string): boolean {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)
  }
}

// Global Exception Filter
@Catch()
export class GlobalExceptionFilter {
  catch(exception: unknown, host: ArgumentsHost) {
    const ctx = host.switchToHttp()
    const response = ctx.getResponse()

    // Domain exceptions
    if (exception instanceof InvalidEmail) {
      return response.status(400).json({ 
        message: exception.message,
        field: 'email'
      })
    }

    if (exception instanceof WeakPassword) {
      return response.status(400).json({ 
        message: exception.message,
        field: 'password'
      })
    }

    if (exception instanceof UserAlreadyExists) {
      return response.status(409).json({ message: exception.message })
    }

    // Infrastructure exceptions
    if (exception instanceof DatabaseError) {
      this.logger.error('Database error', exception)
      return response.status(503).json({ 
        message: 'Service temporarily unavailable' 
      })
    }

    // Unknown exceptions
    this.logger.error('Unhandled exception', exception)
    return response.status(500).json({ message: 'Internal server error' })
  }
}

// Controller - stays clean
@Post('/register')
async register(@Body() dto: RegisterDto) {
  const user = await this.userService.registerUser(dto.email, dto.password)
  return { status: 201, data: user }
}
</code></pre>
<hr />
<h2 id="anti-patterns">Anti-Patterns</h2>
<h3 id="anti-pattern-1-swallowing-exceptions">❌ Anti-Pattern 1: Swallowing Exceptions</h3>
<pre><code class="language-typescript">// BAD - exception is buried
try {
  await service.createOrder(data)
} catch (e) {
  console.log('Error:', e)
  // Exception dies here!
}

// GOOD - re-throw or handle
try {
  await service.createOrder(data)
} catch (e) {
  console.error('Failed to create order:', e)
  throw e // Let it bubble
}
</code></pre>
<h3 id="anti-pattern-2-domain-knows-about-http">❌ Anti-Pattern 2: Domain Knows About HTTP</h3>
<pre><code class="language-typescript">// BAD - domain coupled to HTTP
class OrderService {
  async createOrder(data) {
    if (!product) {
      throw new NotFoundException() // HTTP exception in domain!
    }
  }
}

// GOOD - domain exception
class OrderService {
  async createOrder(data) {
    if (!product) {
      throw new ProductNotFound() // Domain exception
    }
  }
}
</code></pre>
<h3 id="anti-pattern-3-generic-error-messages">❌ Anti-Pattern 3: Generic Error Messages</h3>
<pre><code class="language-typescript">// BAD - loses context
catch (e) {
  throw new Error('Something went wrong')
}

// GOOD - preserve context
catch (e) {
  if (e instanceof UserNotFound) {
    throw new NotFoundException('User not found')
  }
  throw e // Preserve original error
}
</code></pre>
<h3 id="anti-pattern-4-catching-without-re-throwing">❌ Anti-Pattern 4: Catching Without Re-throwing</h3>
<pre><code class="language-typescript">// BAD - catch-all that hides errors
try {
  await doSomething()
} catch (e) {
  return null // Error information lost!
}

// GOOD - only catch what you handle
try {
  await doSomething()
} catch (e) {
  if (e instanceof SpecificError) {
    return null // Only this specific case
  }
  throw e // Re-throw everything else
}
</code></pre>
<h3 id="anti-pattern-5-controller-contains-business-logic">❌ Anti-Pattern 5: Controller Contains Business Logic</h3>
<pre><code class="language-typescript">// BAD - business logic in controller
@Post('/orders')
async createOrder(@Body() dto: CreateOrderDto) {
  const product = await this.productRepo.findBySku(dto.sku)
  if (product.stock &lt; dto.quantity) { // Business rule in controller!
    throw new BadRequestException('Out of stock')
  }
  // ...
}

// GOOD - business logic in service
@Post('/orders')
async createOrder(@Body() dto: CreateOrderDto) {
  return await this.orderService.createOrder(dto)
  // Service handles business rules
}
</code></pre>
<hr />
<h2 id="quick-reference">Quick Reference</h2>
<h3 id="when-to-throw-vs-return-null">When to Throw vs Return Null</h3>
<table>
<thead>
<tr>
<th>Situation</th>
<th>Action</th>
<th>Layer</th>
</tr>
</thead>
<tbody>
<tr>
<td>Invariant violated</td>
<td>Throw domain exception</td>
<td>Service</td>
</tr>
<tr>
<td>Optional value</td>
<td>Return <code>null</code> or <code>Result</code></td>
<td>Service</td>
</tr>
<tr>
<td>Infrastructure error (hide details)</td>
<td>Catch + translate to domain exception</td>
<td>Service</td>
</tr>
<tr>
<td>Infrastructure error (pass through)</td>
<td>Let it bubble</td>
<td>Service</td>
</tr>
<tr>
<td>Need HTTP response</td>
<td>Catch + translate to HTTP exception</td>
<td>Controller or Global Filter</td>
</tr>
<tr>
<td>Caught but not handling</td>
<td><strong>Re-throw</strong></td>
<td>Any</td>
</tr>
</tbody>
</table>
<h3 id="exception-handling-checklist">Exception Handling Checklist</h3>
<ul>
<li>[ ] Domain exceptions are transport-agnostic</li>
<li>[ ] Exceptions bubble to appropriate layer</li>
<li>[ ] No exceptions are swallowed without logging</li>
<li>[ ] Business logic is not in controllers</li>
<li>[ ] Infrastructure details are hidden (if needed)</li>
<li>[ ] Global exception handler is configured</li>
<li>[ ] Error responses are consistent</li>
<li>[ ] Exceptions include meaningful messages</li>
</ul>
<h3 id="common-domain-exceptions">Common Domain Exceptions</h3>
<pre><code class="language-typescript">// Not Found
class UserNotFound extends Error {}
class ProductNotFound extends Error {}
class OrderNotFound extends Error {}

// Validation
class InvalidEmail extends Error {}
class WeakPassword extends Error {}
class InvalidQuantity extends Error {}

// Business Rules
class InsufficientStock extends Error {}
class OrderAlreadyPaid extends Error {}
class UserAlreadyExists extends Error {}

// External Systems
class PaymentFailed extends Error {}
class PaymentGatewayUnavailable extends Error {}
class InventoryServiceUnavailable extends Error {}
</code></pre>
<hr />
<h2 id="further-reading">Further Reading</h2>
<h3 id="architectural-patterns">Architectural Patterns</h3>
<ul>
<li><strong>Domain-Driven Design (DDD)</strong> - Eric Evans</li>
<li><a href="https://en.wikipedia.org/wiki/Domain-driven_design">Wikipedia Overview</a></li>
<li>
<p>Focus: Entities, Value Objects, Aggregates, and Invariants</p>
</li>
<li>
<p><strong>Clean Architecture</strong> - Robert C. Martin</p>
</li>
<li><a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Blog Post</a></li>
<li>
<p>Focus: Layered architecture with dependency rules</p>
</li>
<li>
<p><strong>Hexagonal Architecture (Ports &amp; Adapters)</strong></p>
</li>
<li><a href="https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)">Wikipedia</a></li>
<li>Focus: Isolating business logic from interfaces</li>
</ul>
<h3 id="practical-resources">Practical Resources</h3>
<ul>
<li><a href="https://medium.com/bimar-teknoloji/understanding-clean-architecture-and-domain-driven-design-ddd-24e89caabc40">Understanding Clean Architecture and DDD</a></li>
<li><a href="https://dev.to/dyarleniber/hexagonal-architecture-and-clean-architecture-with-examples-48oi">Hexagonal Architecture with Examples</a></li>
</ul>
<h3 id="framework-specific">Framework-Specific</h3>
<ul>
<li><strong>NestJS</strong>: <a href="https://docs.nestjs.com/exception-filters">Exception Filters Documentation</a></li>
<li><strong>Spring Boot</strong>: <code>@ControllerAdvice</code> pattern</li>
<li><strong>ASP.NET</strong>: Exception Middleware</li>
<li><strong>Express.js</strong>: Error handling middleware</li>
</ul>
<hr />
<h2 id="license">License</h2>
<p>This guide is released under the MIT License. Feel free to use, modify, and share.</p>
<h2 id="contributing">Contributing</h2>
<p>Found an error or have a suggestion? Please open an issue or submit a pull request.</p>
<hr />
<p><strong>Last Updated:</strong> December 20</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "content.code.copy", "header.autohide"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../js/author-avatar.js"></script>
      
    
  </body>
</html>